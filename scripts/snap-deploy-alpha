#!/bin/bash
set -x
set -e
set -o pipefail


ssh -F .sshconfig alpha 'sudo /bin/bash -s' <<-EOF
set -x
set -e
set -o pipefail

yum makecache fast -y
yum install -y "guia-de-servicos-1.0.${SNAP_PIPELINE_COUNTER:-0}-1"

cat <<-EOS > /etc/sysconfig/guia-de-servicos
# Guia de Serviços
#
# Este arquivo contém variáveis de ambiente utilizadas na configuração do Guia de Serviços.
# Para mais informações, veja a documentação em:
#
# http://servicosgovbr.github.io/guia-de-servicos/desenvolvimento/configuracao.html
#
SPRING_PROFILES_ACTIVE=production

ENDPOINTS_ENABLED=false
ENDPOINTS_INFO_ENABLED=true
ENDPOINTS_HEALTH_ENABLED=true
ENDPOINTS_HEALTH_SENSITIVE=false
EOS

systemctl daemon-reload
systemctl restart guia-de-servicos
EOF
