<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:th="http://www.thymeleaf.org"
      layout:decorator="layout-branco">

<head>
    <title th:text="${servico.nome}">Nome do Serviço</title>
    <meta property="og:title" th:content="${servico.nome}"/>
    <meta property="og:description" th:content="${servico.nome + ' no Portal de Serviços do Governo Federal'}"/>
</head>
<body>

<span layout:fragment="migalhas-de-pao">
    <span class="separador">&gt;</span>

    <a href="/servicos" itemprop="url">
        <span itemprop="title">
            Todos os Serviços
        </span>
    </a>

    <span class="separador">&gt;</span>

    <a href="" itemprop="url">
        <span itemprop="title">
            <th:block th:text="${servico.nome}"/> <th:block th:text="|(${servico.sigla})|" th:unless="${#strings.isEmpty(servico.sigla)}"/>
        </span>
    </a>
</span>

<span layout:fragment="menu-contexto" th:replace="fragments/informacoes-relacionadas :: .nav-tree">
</span>

<section layout:fragment="corpo">
    <div class="row">
        <h2>
            <th:block th:text="${servico.nome}"/> <th:block th:text="|(${servico.sigla})|" th:unless="${#strings.isEmpty(servico.sigla)}"/>
        </h2>

<!--         <th:block th:each="acao : ${servico.etapas.![canaisDePrestacao.padrao.canaisDePrestacao.?[tipo.destacado]].get(0)}">
            <a class="acao-servico" th:href="${@conteudoParser.link(acao.descricao)}">
                <th:block th:text="${acao.tipo.value}">Título do link</th:block> <i class="fa fa-globe"></i>
            </a>
        </th:block> -->

        <a href="javascript:window.print()" class="acao-servico">
            Imprimir esta página <i class="fa fa-print"></i></a>

        <div class="markdown" th:utext="${@markdown.render(servico.descricao)}">
            Descrição do serviço
        </div>

        <th:block th:unless="${servico.solicitantes.isEmpty()}">
            <h3 class="subtitulo-servico">Quem pode utilizar este serviço?</h3>
            <div class="solicitantes markdown margem-solicitantes" th:each="solicitante : ${servico.solicitantes}">
                <h4 th:utext="${@markdown.render(solicitante.tipo)}"> Tipo do Solicitante </h4>
                <p th:utext="${@markdown.render(solicitante.requisitos)}"> Requisitos do solicitante (em markdown) </p>
            </div>
        </th:block>

        <th:block th:unless="${servico.tempoTotalEstimado == null}">
            <h3 class="subtitulo-servico">Tempo estimado</h3>
            <th:block th:unless="${servico.tempoTotalEstimado.entre == null}">
                <p>
                    Entre
                    <span th:text="${servico.tempoTotalEstimado.entre.min}"></span>
                    e
                    <span th:text="${servico.tempoTotalEstimado.entre.max}"></span>
                    <span th:text="${servico.tempoTotalEstimado.entre.unidade.nome}"></span>.
                </p>
            </th:block>
            <th:block th:unless="${servico.tempoTotalEstimado.ate == null}">
                <p>
                    Até
                    <span th:text="${servico.tempoTotalEstimado.ate.max}"></span>
                    <span th:text="${servico.tempoTotalEstimado.ate.unidade.nome}"></span>.
                </p>
            </th:block>
            <br></br>
            <h4 class="subtitulo-servico">Informações adicionais ao tempo estimado:</h4>
            <p th:utext="${@markdown.render(servico.tempoTotalEstimado.descricao)}"></p>
        </th:block>

        <th:block th:unless="${servico.etapas.isEmpty()}">

            <h3 class="subtitulo-servico">Etapas para a realização deste serviço</h3>

            <div class="etapas" th:each="etapa, row : ${servico.etapas}">
                <p class="circle" th:text="${row.index + 1}"></p>
                <h4 class="etapa" th:text="${etapa.titulo ?: 'Acesse o serviço'}">Título da etapa</h4>
    
                <div class="etapa markdown" th:utext="${@markdown.render(etapa.descricao)}">Descrição da etapa</div>

                <div class="subtitulo-etapa" th:unless="${etapa.documentos.isEmpty()}">
                    <p class="info-etapa">Documentos necessários</p>
                    <ul>
                        <li th:each="doc : ${etapa.documentos.padrao.itens}">
                            <span th:text="${doc}">Documento necessário</span>
                        </li>
                    </ul>

                    <ul th:each="caso : ${etapa.documentos.casos}">
                        <div th:text="${caso.descricao}"></div>
                        <li th:each="doc : ${caso.itens}">
                            <span th:text="${doc}">Documento necessário</span>
                        </li>
                    </ul>
                </div>

                <div class="subtitulo-etapa" th:unless="${etapa.custos.isEmpty()}">
                    <p class="info-etapa">Custos desta etapa</p>
                    <ul>
                        <li th:each="custo : ${etapa.custos.padrao.custos}">
                            <span th:text="${custo.descricao}">Descrição</span>
                            <span th:text="${custo.moeda ?: 'R$'}">R$</span>
                            <span th:text="${custo.valor}">0,00</span>
                        </li>
                    </ul>

                    <ul th:each="caso : ${etapa.custos.casos}">
                        <div th:text="${caso.descricao}"></div>
                        <li th:each="custo : ${caso.custos}">
                            <span th:text="${custo.descricao}">Descrição</span>
                            <span th:text="${custo.moeda ?: 'R$'}">R$</span>
                            <span th:text="${custo.valor}">0,00</span>
                        </li>
                    </ul>
                </div>

                <div class="subtitulo-etapa" th:unless="${etapa.canaisDePrestacao.isEmpty()}">
                    <p class="info-etapa">Canais de prestação desta etapa:</p>
                    <ul>
                        <li th:each="canal : ${etapa.canaisDePrestacao.padrao.canaisDePrestacao}">
                            <span th:text="${canal.tipo.value}">Web</span>:
                            <th:block th:if="${canal.tipo.destacado}">
                                <a th:href="${@conteudoParser.link(canal.descricao)}"
                                   th:text="${@conteudoParser.link(canal.descricao)}">Link</a>
                            </th:block>
                            <th:block th:unless="${canal.tipo.destacado}">
                                <p th:utext="${@markdown.render(canal.descricao)}">Texto</p>
                            </th:block>
                        </li>
                    </ul>

                    <th:block th:each="acao : ${servico.etapas.![canaisDePrestacao.padrao.canaisDePrestacao.?[tipo.destacado]].get(0)}">
                        <a class="acao-servico" th:href="${@conteudoParser.link(acao.descricao)}">
                            <th:block th:text="${acao.tipo.value}">Título do link</th:block> <i class="fa fa-globe"></i>
                        </a>
                    </th:block>


                    <ul th:each="caso : ${etapa.canaisDePrestacao.casos}">
                        <div th:text="${caso.descricao}"></div>
                        <li th:each="canal : ${caso.canaisDePrestacao}">
                            <span th:text="${canal.tipo.value}">Web</span>:
                            <th:block th:if="${canal.tipo.destacado}">
                                <a th:href="${@conteudoParser.link(canal.descricao)}"
                                   th:text="${@conteudoParser.link(canal.descricao)}">Link</a>
                            </th:block>
                            <th:block th:unless="${canal.tipo.destacado}">
                                <p th:utext="${@markdown.render(canal.descricao)}">Texto</p>
                            </th:block>
                        </li>
                    </ul>
                </div>
            </div>
        </th:block>
    </div>

    <th:block th:unless="${servico.legislacoes.isEmpty()}">
        <h3 class="subtitulo-servico">Legislação relacionada</h3>
        <ul>
            <li th:each="legislacao : ${servico.legislacoes}">
                <span th:utext="${@markdown.render(legislacao)}">Lei XXX de NNNN, ZZZZ</span>
            </li>
        </ul>
    </th:block>

    <div class="row" th:with="orgao = ${@orgaoRepository.findAll().?[id == '__${servico.orgao.id}__'][0]}">
        <p class="separacao-orgao" th:unless="${#strings.isEmpty(orgao.nome)}">
            Este é um serviço
            <th:block th:text="${@genero.de(orgao.id)}">do(a)</th:block>
            <a th:unless="${#strings.isEmpty(orgao.id)}"
               th:href="@{/orgao/{id}(id=${orgao.id})}"
               th:text="${orgao.nome}">
                Órgão responsavel
            </a>.
            Em caso de dúvidas, reclamações ou sugestões favor
            contactá-<th:block th:text="${@genero.lo(orgao.id)}">lo(a)</th:block>.
        </p>

        <hr style="margin-top: 20px; border: none"/>
    </div>

    <div class="row">
        <form class="feedback-servico" accept-charset="UTF-8" action="/opiniao" method="post">

            <h3 class="opiniao">Você achou as informações acima úteis?</h3>

            <p class="formulario-opiniao">
                <label for="sim">Sim</label>
                <input name="conteudoEncontrado" id="sim" class="left" type="radio" value="true" required="required"/>

                <br class="clear"/>

                <label for="nao">Não</label>
                <input name="conteudoEncontrado" id="nao" class="left" type="radio" value="false"/>
            </p>

            <label for="opiniao">
                <h3 class="opiniao">Quais informações você sentiu falta neste serviço?</h3>

                <textarea id="opiniao" name="mensagem" rows="5" class="row"></textarea>
            </label>

            <input name="enviar" type="submit" class="acao" value="ENVIAR"/>

            <input name="utf8" type="hidden" value="✓"/><!-- força utf8 -->
            <input name="url" type="hidden" th:value="${#httpServletRequest.requestURI}"/>
            <input name="busca" type="hidden" th:value="${#httpServletRequest.queryString}"/>
            <input name="ticket" type="hidden" th:value="${#httpServletRequest.getAttribute('req.ticket').substring(24)}"/>
        </form>

        <span class="link-github">
            <a class="acao-servico right"
               th:if="${@cookies.isOn('modo-edicao')}"
               th:href="${'/editar/servico/' + servico.id }">
                Editar
            </a>
        </span>
    </div>
</section>

</body>
</html>
